{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Device Recommendation</title>
    <link rel="stylesheet" href="{% static 'css/site.css' %}">
</head>
<body>
<div class="page">
    <header class="hero">
        <h1>Find Your Ideal Smart Device</h1>
        <p>Filter through the collection using price, RAM, display, camera, and more to identify the best fit.</p>
    </header>

    <form method="get" class="filter-card">
        <div class="filter-grid">
            <div>
                <label>Brand</label>
                <select name="brand">
                    <option value="">All brands</option>
                    {% for option in brand_options %}
                        <option value="{{ option }}" {% if brand == option %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>Processor</label>
                <select name="processor">
                    <option value="">Any processor</option>
                    {% for option in processor_options %}
                        <option value="{{ option }}" {% if processor == option %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>Display</label>
                <select name="display">
                    <option value="">Any display</option>
                    {% for option in display_options %}
                        <option value="{{ option }}" {% if display == option %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>Front Camera</label>
                <select name="front_camera">
                    <option value="">Any front camera</option>
                    {% for option in front_camera_options %}
                        <option value="{{ option }}" {% if front_camera == option %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>Back Camera</label>
                <select name="back_camera">
                    <option value="">Any rear camera</option>
                    {% for option in back_camera_options %}
                        <option value="{{ option }}" {% if back_camera == option %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>Battery (≤)</label>
                <select name="battery">
                    <option value="">Any battery</option>
                    {% for option in battery_options %}
                        <option value="{{ option }}" {% if battery == option %}selected{% endif %}>{{ option }} mAh</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>RAM · Storage</label>
                <select id="ramStorageSelect">
                    <option value="">Any combination</option>
                    {% for combo in ram_storage_options %}
                        <option value="{{ combo.ram }}|{{ combo.storage }}" {% if ram == combo.ram and storage == combo.storage %}selected{% endif %}>
                            {{ combo.ram }} GB · {{ combo.storage }} GB
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="range-field">
            <label class="slider-label">
                Budget
                <span id="priceValue">₹{{ price }}</span>
            </label>
            <input
                id="priceSlider"
                type="range"
                name="price"
                min="{{ price_min }}"
                max="{{ price_max }}"
                step="{{ price_step }}"
                value="{{ price }}"
            >
        </div>

        <input type="hidden" name="ram" id="ramInput" value="{{ ram|default_if_none:'' }}">
        <input type="hidden" name="storage" id="storageInput" value="{{ storage|default_if_none:'' }}">

        <button type="submit">Apply Filters</button>
    </form>

    <section>
        <div class="section-title">
            <h3>Available Devices</h3>
            <span>Page {{ current_page }} of {{ total_pages }}</span>
        </div>

        <div class="device-grid">
            {% for d in devices %}
                <article class="device-card">
                    <h4>{{ d.name }}</h4>
                    <p class="device-meta">Brand: {{ d.brand }}</p>
                    <p class="device-meta">Processor: {{ d.processor }}, Display: {{ d.display }}</p>
                    <p class="device-meta">RAM: {{ d.ram }} GB · Storage: {{ d.storage }} GB</p>
                    <p class="device-meta">Battery: {{ d.battery }} · Cameras: {{ d.front_camera }}/{{ d.back_camera }}</p>
                    <p class="device-price">₹{{ d.price }}</p>
                </article>
            {% endfor %}
        </div>

        <div class="pagination">
            {% if current_page > 1 %}
                <a href="?page={{ current_page|add:-1 }}{{ pagination_query }}">
                    ⬅ Prev
                </a>
            {% endif %}

            Page {{ current_page }} of {{ total_pages }}

            {% if current_page < total_pages %}
                <a href="?page={{ current_page|add:1 }}{{ pagination_query }}">
                    Next ➡
                </a>
            {% endif %}
        </div>
    </section>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const priceSlider = document.getElementById("priceSlider");
        const priceValue = document.getElementById("priceValue");
        if (priceSlider && priceValue) {
            const updateValue = () => {
                const formatted = Number(priceSlider.value).toLocaleString("en-IN");
                priceValue.textContent = `₹${formatted}`;
            };
            priceSlider.addEventListener("input", updateValue);
            updateValue();
        }

        const comboSelect = document.getElementById("ramStorageSelect");
        const ramInput = document.getElementById("ramInput");
        const storageInput = document.getElementById("storageInput");
        if (comboSelect && ramInput && storageInput) {
            const syncFields = () => {
                const [ram, storage] = comboSelect.value.split("|");
                ramInput.value = ram || "";
                storageInput.value = storage || "";
            };
            syncFields();
        }
    });
    document.addEventListener("DOMContentLoaded", function () {
        const brandSelect = document.querySelector("select[name='brand']");
        if (brandSelect) {
            brandSelect.addEventListener("change", function () {
                this.form.submit();
            });
        }
    });
</script>


</body>
</html>
